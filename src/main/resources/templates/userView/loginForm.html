<!DOCTYPE html>
<html
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        xmlns:th="http://www.thymeleaf.org"
        layout:decorate="~{homeLayout}">

<!-- 페이지별 css -->
<style layout:fragment="styles">
    /* 패스워드 토글 버튼 스타일링 */
    #togglePassword {
        border: none;
        background: transparent;
        padding: 0;
        cursor: pointer;
        /* 아이콘이 입력 필드 위에 겹치지 않도록 위치 조정 */
        /*height: 100%;*/
        width: 2.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* 비밀번호 강도 표시 스타일 */
    #passwordStrength {
        font-weight: bold;
    }

    /* 애니메이션 효과 추가 */
    .is-invalid + .invalid-feedback,
    #passwordStrength {
        transition: opacity 0.3s ease-in-out;
        opacity: 0;
    }

    .is-invalid + .invalid-feedback,
    #passwordStrength.text-danger,
    #passwordStrength.text-warning,
    #passwordStrength.text-success {
        opacity: 1;
    }
</style>
<!-- 페이지별 콘텐츠 -->
<div layout:fragment="content">
    <div class="container vh-100 d-flex justify-content-center align-items-center">
        <div class="row w-100">
            <div class="col-md-8 col-lg-6 mx-auto">
                <div class="card shadow-lg">
                    <div class="card-body p-4">
                        <!-- 로고 추가 (선택 사항) -->
                        <div class="text-center mb-4">
                            <img th:src="@{/images/logo.png}" alt="사이트 로고" class="img-fluid" style="max-width: 150px;">
                        </div>
                        <h3 class="card-title text-center mb-4">로그인</h3>
                        <form action="/user/login" method="post" novalidate>
                            <!-- 아이디 입력 그룹 -->
                            <div class="mb-3">
                                <label for="id" class="form-label">아이디</label>
                                <div class="input-group">
                                    <span class="input-group-text" id="basic-addon1"><i class="fas fa-user"></i></span>
                                    <input type="text" class="form-control" id="id" name="id" placeholder="아이디를 입력하세요"
                                           aria-describedby="basic-addon1" required>
                                    <div class="invalid-feedback">
                                        아이디를 입력하세요.
                                    </div>
                                </div>
                            </div>
                            <!-- 비밀번호 입력 그룹 -->
                            <div class="mb-4 position-relative">
                                <label for="password" class="form-label">비밀번호</label>
                                <div class="input-group">
                                    <span class="input-group-text" id="basic-addon2"><i class="fas fa-lock"></i></span>
                                    <input type="password" class="form-control" id="password" name="password"
                                           placeholder="비밀번호를 입력하세요" aria-describedby="basic-addon2" required>
                                    <button type="button" class="btn btn-outline-secondary" id="togglePassword"
                                            aria-label="비밀번호 표시" aria-pressed="false">
                                        <i class="fas fa-eye" id="togglePasswordIcon"></i>
                                    </button>
                                    <div class="invalid-feedback">
                                        비밀번호를 입력하세요.
                                    </div>
                                </div>
                                <!-- 비밀번호 강도 표시 (옵션) -->
<!--                                <div id="passwordStrength" class="mt-2"></div>-->
                            </div>
                            <!-- 로그인 버튼 -->
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary btn-lg">로그인</button>
                            </div>
                        </form>
                        <!-- 회원가입 링크 -->
                        <div class="mt-3 text-center">
                            <span>계정이 없으신가요? </span>
                            <a th:href="@{/user/joinForm}" class="text-decoration-none">회원가입</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 페이지별 스크립트 삽입 -->
<div layout:fragment="scripts">
    <script>
        $(document).ready(function () {
            // 폼 유효성 검사
            $('form').on('submit', function (event) {
                // 모든 입력 필드의 유효성 상태 초기화
                $('input').removeClass('is-invalid is-valid');

                let isValid = true;

                // 아이디 유효성 검사
                const idInput = $('#id');
                if ($.trim(idInput.val()) === '') {
                    idInput.addClass('is-invalid');
                    isValid = false;
                } else if (idInput.val().length < 3) { // 최소 길이 조건
                    idInput.addClass('is-invalid');
                    isValid = false;
                    idInput.next('.invalid-feedback').text('아이디는 최소 3자 이상이어야 합니다.');
                } else {
                    idInput.addClass('is-valid');
                }

                // 비밀번호 유효성 검사
                const passwordInput = $('#password');
                if ($.trim(passwordInput.val()) === '') {
                    passwordInput.addClass('is-invalid');
                    isValid = false;
                } else if (passwordInput.val().length < 3) { // 최소 길이 조건
                    passwordInput.addClass('is-invalid');
                    isValid = false;
                    passwordInput.next('.invalid-feedback').text('비밀번호는 최소 3자 이상이어야 합니다.');
                } else {
                    passwordInput.addClass('is-valid');
                }

                if (!isValid) {
                    event.preventDefault(); // 폼 제출 방지
                    event.stopPropagation();
                }
            });

            // 패스워드 표시 토글 기능
            $('#togglePassword').on('click', function () {
                const passwordInput = $('#password');
                const icon = $('#togglePasswordIcon');

                const type = passwordInput.attr('type') === 'password' ? 'text' : 'password';
                passwordInput.attr('type', type);

                // 아이콘 변경
                icon.toggleClass('fa-eye fa-eye-slash');

                // ARIA 속성 업데이트
                const isPressed = $(this).attr('aria-pressed') === 'true';
                $(this).attr('aria-pressed', !isPressed);
            });

            // 실시간 유효성 검사 (옵션)
            $('#id').on('input', function () {
                const idInput = $(this);
                if ($.trim(idInput.val()) !== '' && idInput.val().length >= 3) {
                    idInput.removeClass('is-invalid').addClass('is-valid');
                } else {
                    idInput.removeClass('is-valid');
                }
            });

            $('#password').on('input', function () {
                const passwordInput = $(this);
                if ($.trim(passwordInput.val()) !== '' && passwordInput.val().length >= 3) {
                    passwordInput.removeClass('is-invalid').addClass('is-valid');
                } else {
                    passwordInput.removeClass('is-valid');
                }

                // 비밀번호 강도 표시 (옵션)
                const password = passwordInput.val();
                const strength = getPasswordStrength(password);
                const strengthDiv = $('#passwordStrength');

                strengthDiv.removeClass();

                if (strength === 'Weak') {
                    strengthDiv.addClass('text-danger').text('비밀번호 강도: 약함');
                } else if (strength === 'Medium') {
                    strengthDiv.addClass('text-warning').text('비밀번호 강도: 보통');
                } else if (strength === 'Strong') {
                    strengthDiv.addClass('text-success').text('비밀번호 강도: 강함');
                } else {
                    strengthDiv.text('');
                }
            });

            // 비밀번호 강도 판단 함수
            function getPasswordStrength(password) {
                let strength = 0;

                if (password.length >= 6) strength++;
                if (password.match(/[A-Z]/)) strength++;
                if (password.match(/[0-9]/)) strength++;
                if (password.match(/[^A-Za-z0-9]/)) strength++;

                if (strength >= 4) return 'Strong';
                if (strength >= 2) return 'Medium';
                return 'Weak';
            }

            // 아이디 필드에서 엔터키를 눌렀을 때 비밀번호 필드로 포커스 이동
            $('#id').on('keypress', function (event) {
                if (event.which === 13) { // Enter key code
                    event.preventDefault();
                    $('#password').focus();
                }
            });
        });
    </script>
</div>
</html>
