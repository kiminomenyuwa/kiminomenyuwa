<!DOCTYPE html>
<html
  xmlns:th="http://thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>키미노 메뉴와</title>
    <script src="/js/jquery-3.7.1.min.js"></script>

    <script th:inline="javascript">
      $(document).ready(function () {
        let menus = /*[[${menus}]]*/ []; // Thymeleaf로 전달된 메뉴 리스트
        let previousIndexes = []; // 이미 표시된 메뉴 인덱스를 저장할 배열

        function showRandomMenu() {
          if (previousIndexes.length >= menus.length) {
            alert("모든 메뉴를 다 보셨습니다!");
            return;
          }

          let randomIndex;
          do {
            randomIndex = Math.floor(Math.random() * menus.length);
          } while (previousIndexes.includes(randomIndex));

          previousIndexes.push(randomIndex);

          let randomMenu = menus[randomIndex];
          let menuHtml = "<h2>" + randomMenu.name + "</h2>"; // 메뉴 이름만 표시

          $("#random-menu").html(menuHtml);
        }

        // 페이지 로드 시 첫 번째 메뉴를 표시
        showRandomMenu();

        // 다시 시작 버튼 클릭 시 새로운 랜덤 메뉴를 표시
        $("#restart").click(function () {
          showRandomMenu();
        });
      });
    </script>
  </head>
  <body>
    <h1>홈페이지</h1>
    <h2 sec:authorize="isAuthenticated()" th:text="|${#authentication.principal.name}님 환영합니다|"></h2>

    <div sec:authorize="not isAuthenticated()">
      <p><a href="user/joinForm">회원가입</a></p>
      <p><a href="user/loginForm">로그인</a></p>
    </div>
    <div sec:authorize="isAuthenticated()">
      <p><a href="user/logout">로그아웃</a></p>
<!--      <p><a href="/mypage">마이페이지</a></p>-->
    </div>

    <p>
      <a href="storeRegistration">가게 등록</a>
    </p>

    <!-- 메뉴를 랜덤으로 표시할 영역 -->
    <div id="random-menu">
      <p>랜덤 메뉴를 불러오는 중...</p>
    </div>

    <!-- 다시 시작 버튼 -->
    <button id="restart">다시시작</button>
  </body>
</html>
