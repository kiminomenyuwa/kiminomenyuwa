<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<title>가게 등록</title>

<script src="/js/jquery-3.7.1.min.js"></script>
<!-- 카카오 도로명주소 서비스 호출 -->
<script
	src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
	$(document).ready(function() {
		//도로명주소 새창 팝업
		$('#searchAddressBtn').click(kakaoRoadAddress);
		//회원가입 데이터 보냄
		$('#submitForm').click(function() {
			let formData = new FormData($('#storeForm')[0]);
			// 추가 데이터 (enabled) 설정
			formData.append('enabled', true); // 기본적으로 가게는 활성화됨

			let registration = {
				userId : $('#userId').val(),
				name : $('#name').val(),
				certification : $('#certification').val(),
				roadNameAddress : $('#roadNameAddress').val(),
				detailAddress : $('#detailAddress').val(),
				zipcode : $("#zipcode").val(),
				phoneNumber : $("#phoneNumber").val(),
				category : $("#category").val(),
				description : $("#description").val(),
				enabled : true
			// 기본적으로 가게는 활성화됨
			};

			console.log(registration);

			$.ajax({
				url : 'storeRegistration',
				type : 'post',
				data: formData,
				processData: false, // jQuery가 데이터를 처리하지 않도록 설정
				contentType: false, // jQuery가 콘텐츠 타입을 설정하지 않도록 설정
				success : function() {
					alert('가게가 정상 등록되었습니다.');
					// 성공하면 페이지 리다이렉트
					window.location.href = '/storePage'; // 리다이렉트할 페이지 경로
				},
				error : function(e) {
					console.log(JSON.stringify(e));
					$("#response").html("가게 등록에 실패했습니다.");
				}
			})
		})
	})

	//카카오 도로명주소 사용
	function kakaoRoadAddress() {
		new daum.Postcode({
			oncomplete : function(data) {
				//카카오 도로명주소에서 받아온 data html에 반영
				$('#zipcode').val(data.zonecode);
				$('#roadNameAddress').val(data.roadAddress);
			}
		}).open();
	}
</script>
</head>
<body>
	<h1>가게 등록</h1>
	<form id="storeForm">
		<table>
			<!-- 현재 아이디는 외래키로 가져오는 것이 아닌 임의로 user를 한 명 생성 후 직접 넣어야 돌아감 -->
			<tr>
				<td><label for="userId">아이디</label></td>
				<td><input type="text" id="userId" name="userId" required></td>
			</tr>
			<tr>
				<td><label for="name">가게 이름:</label></td>
				<td><input type="text" id="name" name="name" required></td>
			</tr>
			<tr>
				<td><label for="certification">인증 정보:</label></td>
				<td><input type="text" id="certification" name="certification"
					required></td>
			</tr>
			<tr>
				<td><label for="zipcode">우편번호:</label></td>
				<td><input type="text" id="zipcode" name="zipcode" readonly
					placeholder="주소 검색 기능 사용">
					<button type="button" id="searchAddressBtn">주소검색</button></td>
			</tr>
			<tr>
				<td><label for="roadNameAddress">도로명 주소:</label></td>
				<td><input type="text" id="roadNameAddress"
					name="roadNameAddress" readonly placeholder="주소 검색 기능 사용"></td>
			</tr>
			<tr>
				<td><label for="detailAddress">상세 주소:</label></td>
				<td><input type="text" id="detailAddress" name="detailAddress"></td>
			</tr>
			<tr>
				<td><label for="phoneNumber">전화번호:</label></td>
				<td><input type="text" id="phoneNumber" name="phoneNumber"></td>
			</tr>
			<tr>
				<td><label for="category">카테고리:</label></td>
				<td><input type="text" id="category" name="category"></td>
			</tr>
			<tr>
				<td><label for="description">설명:</label></td>
				<td><textarea id="description" name="description"></textarea></td>
			</tr>
			<!-- 사진 업로드 필드 추가 -->
			<tr>
				<td><label for="photos">사진 업로드:</label></td>
				<td>
					<input type="file" id="photos" name="photos" multiple accept="image/*">
					<small>여러 장의 사진을 선택할 수 있습니다.</small>
				</td>
			</tr>
			<tr>
				<td colspan="2">
					<button type="button" id="submitForm">등록</button>
				</td>
			</tr>
		</table>
	</form>

	<p id="response"></p>
</body>
</html>