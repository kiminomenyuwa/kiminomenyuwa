<!DOCTYPE html>
<html
  xmlns:th="http://thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <title>가게 페이지</title>
    <style>
      .main-photo {
        width: 100px;
        height: 100px;
        border-radius: 5px;
      }
    </style>
    <script src="/js/jquery-3.7.1.min.js"></script>
    <script>
      $(document).ready(function () {
        $.ajax({
          url: "/api/stores", // 현재 사용자의 가게 정보를 불러오는 API 엔드포인트
          method: "GET",
          success: function (store) {
            console.log(store);
            const storeList = $("#storeList"); // 가게 정보를 표시할 <ul> 요소 선택

            // 가게 정보를 표시하는 리스트 항목 생성
            const listItem = $("<li></li>").text(
              store.name +
                " - " +
                store.roadNameAddress +
                " " +
                store.detailAddress
            );
            listItem.click(function () {
              window.location.href = "/store/" + store.storeId; // 가게 ID를 URL에 포함
            });

            // 필요한 경우 위도, 경도도 표시
            if (store.latitude && store.longitude) {
              const locationItem = $("<li></li>").text(
                "Location: " + store.latitude + ", " + store.longitude
              );
              listItem.append(locationItem);
            }

            storeList.append(listItem);
          },
          error: function (e) {
            console.log(JSON.stringify(e));
            alert("가게 정보를 불러오는데 실패했습니다.");
          },
        });
      });
    </script>
  </head>
  <body>
    <h1
      sec:authorize="isAuthenticated()"
      th:text="|${#authentication.principal.name}님의 가게|"
    >
      [가게 페이지]
    </h1>

    <p>
      <a href="storeRegistration">가게 등록</a>
    </p>

    <ul id="storeList">
      <!-- 여기에 가게 리스트가 표시됩니다 -->
    </ul>
  </body>
</html>
