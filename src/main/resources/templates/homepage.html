<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{homeLayout}">
<style layout:fragment="styles">
    /* 게임 시작 버튼 스타일 설정 */
    #user-start-game {
        display: inline-block; /* 요소를 인라인 블록으로 설정 */
        width: 150px; /* 버튼 너비 */
        height: 50px; /* 버튼 높이 */
        font-size: 16px; /* 버튼 텍스트 크기 */
        border: 2px solid #ccc; /* 회색 테두리 */
        border-radius: 5px; /* 모서리를 둥글게 처리 */
        background-color: #f9f9f9; /* 배경색 설정 */
        cursor: pointer; /* 마우스 커서를 포인터로 변경 */
        text-align: center; /* 텍스트를 중앙 정렬 */
        /* line-height: 50px; 텍스트를 버튼 높이에 맞춰 세로 중앙 정렬 */
        font-weight: bold; /* 텍스트를 굵게 설정 */
    }

    /* "좋아요" 버튼 스타일 설정 */
    #user-like-button {
        display: inline-block; /* 요소를 인라인 블록으로 설정 */
        width: 150px; /* 버튼 너비를 "싫어요" 버튼과 동일하게 설정 */
        height: 50px; /* 버튼 높이를 "싫어요" 버튼과 동일하게 설정 */
        font-size: 16px; /* 버튼 텍스트 크기 */
        border: 2px solid #ccc; /* 회색 테두리 */
        border-radius: 5px; /* 모서리를 둥글게 처리 */
        background-color: #f9f9f9; /* 배경색 설정 */
        cursor: pointer; /* 마우스 커서를 포인터로 변경 */
        position: relative; /* 자식 요소의 위치 설정을 위한 상대적 위치 지정 */
        text-align: center; /* 텍스트를 중앙 정렬 */
        line-height: 50px; /* 텍스트를 버튼 높이에 맞춰 세로 중앙 정렬 */
        font-weight: bold; /* 텍스트를 굵게 설정 */
        overflow: hidden; /* 자식 요소가 버튼을 넘어가지 않도록 숨김 */
    }

    /* "싫어요" 버튼 스타일 설정 (좋아요 버튼과 동일한 크기로 설정) */
    #user-dislike-button {
        display: inline-block; /* 요소를 인라인 블록으로 설정 */
        width: 150px; /* 버튼 너비 */
        height: 50px; /* 버튼 높이 */
        font-size: 16px; /* 버튼 텍스트 크기 */
        border: 2px solid #ccc; /* 회색 테두리 */
        border-radius: 5px; /* 모서리를 둥글게 처리 */
        background-color: #f9f9f9; /* 배경색 설정 */
        cursor: pointer; /* 마우스 커서를 포인터로 변경 */
        text-align: center; /* 텍스트를 중앙 정렬 */
        /* line-height: 50px; 텍스트를 버튼 높이에 맞춰 세로 중앙 정렬 */
        font-weight: bold; /* 텍스트를 굵게 설정 */
    }

    /* 별점 컨테이너 스타일 설정 (기본적으로 숨김 처리) */
    .stars {
        position: absolute; /* 부모 요소를 기준으로 절대 위치 지정 */
        top: 50%; /* 부모 요소의 세로 중앙에 위치 */
        left: 50%; /* 부모 요소의 가로 중앙에 위치 */
        transform: translate(-50%, -50%); /* 정확한 중앙 위치를 위해 변환 */
        display: flex; /* 별들을 플렉스 컨테이너로 설정 */
        justify-content: center; /* 별들을 가로 중앙 정렬 */
        align-items: center; /* 별들을 세로 중앙 정렬 */
        font-size: 24px; /* 별의 크기 */
        width: auto; /* 별 컨테이너의 너비를 내용에 맞게 자동 설정 */
        height: 24px; /* 별 컨테이너의 높이 */
        display: none; /* 기본적으로 숨김 처리 */
    }

    /* 기본 별 스타일 설정 */
    .star {
        color: #ccc; /* 별의 기본 색상 (회색) */
        cursor: pointer; /* 마우스 커서를 포인터로 변경 */
        margin: 0; /* 별 사이의 기본 간격 제거 */
        letter-spacing: -3px; /* 별들 사이의 간격 조정 */
    }

    /* 노란색으로 채워지는 별 스타일 설정 */
    .star.fill {
        color: #ffcc00; /* 채워진 별의 색상을 노란색으로 설정 */
    }

    /* user-rating-controls 내 콘텐츠들을 중앙에 정렬 */
    #user-rating-controls {
        display: flex; /* 컨트롤을 플렉스 박스로 설정 */
        justify-content: left; /* 버튼들을 왼쪽 정렬 */
        align-items: center; /* 버튼들을 세로 중앙 정렬 */
        gap: 10px; /* 버튼들 사이의 간격 조절 */
    }

    /* 슬롯머신 css */
    .slot-machine {
        /* display: flex; */
        flex-direction: column;
        align-items: center;
    }

    .reels {
        display: flex;
        /* justify-content: center; */
        margin-bottom: 20px;
    }

    .reel {
        width: 150px;
        height: 80px;
        overflow: hidden;
        border: 2px solid white;
        background-color: #444;
        position: relative;
    }

    .symbols {
        display: flex;
        flex-direction: column;
        animation: none;
        position: absolute;
        top: 0;
        transition: top 1s ease-out;
    }

    .symbol {
        width: 150px;
        height: 80px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        background-color: #444;
        color: white;
        text-align: center;
    }

    button {
        padding: 10px 20px;
        font-size: 1rem;
        background-color: #61dafb;
        border: none;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    button:hover {
        background-color: #21a1f1;
    }

    .result {
        margin-top: 20px;
        font-size: 1.5rem;
    }
</style>
<div layout:fragment="content">
    <!-- 로그인한 사용자에게 환영 메시지 표시 -->
    <h2 sec:authorize="isAuthenticated()" th:text="|${#authentication.principal.name}님 환영합니다|"></h2>

    <!-- 로그인한 사용자의 프로필 사진을 표시 -->
    <div sec:authorize="isAuthenticated()">
        <img th:src="@{/images/avatar.jpg}" alt="프로필 사진" style="width: 100px; height: 100px; border-radius: 50%"/>
    </div>

    <!-- 로그인된 사용자용 메뉴 -->
    <div sec:authorize="isAuthenticated()">
        <p>
            <a href="/friendships/list">친구</a> <span th:text="${friendCount}">0</span>
            <!-- DB에 저장된 친구 수 표시 -->
        </p>
        <p>
            <a href="/merchant/stores">사장님 가게 페이지</a>
        </p>
        <ul>
            <li><a href="recommend/test">메뉴추천(테스트페이지)</a></li>
            <li><a href="recommend/recommendUntriedFood">안먹어본 메뉴 추천</a></li>
            <li><a href="recommend/recommendByMinigame">미니게임 결과에 따른 메뉴 추천</a></li>
        </ul>

        <ul>
            <li><a href="/recommendations/map">추천 검색 페이지</a></li>
        </ul>
    </div>

    <!-- 비회원용 메뉴 추천 섹션 -->
    <div sec:authorize="not isAuthenticated()" id="menu-section">
        <!-- 위치와 반경 선택 -->
        <div id="location-section">
            <h3>현재 위치</h3>
            <p id="current-address">위치를 불러오는 중...</p>
            <label for="radius-select">반경 선택:</label>
            <select id="radius-select">
                <option value="300">300m</option>
                <option value="500" selected>500m</option>
                <option value="1000">1000m</option>
                <option value="2000">2000m</option>
            </select>
        </div>

        <!-- 메뉴 추천 메시지 및 결과 표시 -->
        <div id="selected-menu">
            <h2 id="menu-header">메뉴 룰렛을 누르세요</h2>
            <img id="menu-image" src="" alt="메뉴 이미지" style="display: none; width: 200px; height: 200px"/>
        </div>

        <!-- 게임 시작 버튼 -->
        <div id="menu-controls">
            <button id="start-game">게임 시작</button>
        </div>
    </div>

    <!-- 회원용 메뉴 추천 섹션 -->
    <div sec:authorize="isAuthenticated()" id="user-menu-section">
        <h2>[ 회원용 ]</h2>

        <!-- 위치와 반경 선택 -->
        <div id="user-location-section">
            <h3>현재 위치</h3>
            <p id="user-current-address">위치를 불러오는 중...</p>
            <label for="user-radius-select">반경 선택:</label>
            <select id="user-radius-select">
                <option value="300">300m</option>
                <option value="500" selected>500m</option>
                <option value="1000">1000m</option>
                <option value="2000">2000m</option>
            </select>
        </div>

        <!-- 메뉴 추천 메시지 및 결과 표시 -->
        <div id="user-selected-menu">
            <h2 id="user-menu-header">메뉴 룰렛을 누르세요</h2>
            <img id="user-menu-image" src="" alt="메뉴 이미지" style="display: none; width: 200px; height: 200px"/>
        </div>

        <!-- 회원용 게임 시작 버튼 -->
        <div id="user-menu-controls">
            <button id="user-start-game">게임 시작</button>
        </div>

        <!-- 좋아요/싫어요 버튼 -->
        <div id="user-rating-controls" style="display: none">
            <!-- 3점 고정 체크박스 -->
            <div>
                <input type="checkbox" id="fixed-rating-checkbox"/> <label for="fixed-rating-checkbox">좋아요 3점 고정</label>
            </div>

            <!-- 좋아요 버튼과 별점 컨트롤 -->
            <div id="user-like-button">
                좋아요
                <div class="stars">
                    <span class="star" data-value="1">★</span>
                    <span class="star" data-value="2">★</span>
                    <span class="star" data-value="3">★</span>
                    <span class="star" data-value="4">★</span>
                    <span class="star" data-value="5">★</span>
                </div>
            </div>

            <!-- 싫어요 버튼 -->
            <button id="user-dislike-button">싫어요</button>
        </div>
    </div>
</div>

<script layout:fragment="scripts">
    $(document).ready(function () {
        // 현재 위치 불러오기
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition, showError);
        } else {
            $('#current-address').text("Geolocation is not supported by this browser.");
            $('#user-current-address').text("Geolocation is not supported by this browser.");
        }

        function showPosition(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;

            // 네이버 지도 Geocoder 사용하여 주소 변환
            const geocoder = new naver.maps.Geocoder();

            geocoder.coord2Address(lng, lat, function (status, response) {
                if (status === naver.maps.Service.Status.OK) {
                    const address = response.v2.address.jibunAddress || response.v2.address.roadAddress;  // 지번 주소나 도로명 주소 중 사용
                    $('#current-address').text(address);
                    $('#user-current-address').text(address);
                } else {
                    $('#current-address').text("주소를 불러올 수 없습니다.");
                    $('#user-current-address').text("주소를 불러올 수 없습니다.");
                }
            });
        }

        function showError(error) {
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    $('#current-address').text("사용자가 위치 정보 제공을 거부했습니다.");
                    $('#user-current-address').text("사용자가 위치 정보 제공을 거부했습니다.");
                    break;
                case error.POSITION_UNAVAILABLE:
                    $('#current-address').text("위치 정보를 사용할 수 없습니다.");
                    $('#user-current-address').text("위치 정보를 사용할 수 없습니다.");
                    break;
                case error.TIMEOUT:
                    $('#current-address').text("위치 정보를 가져오는 데 시간이 초과되었습니다.");
                    $('#user-current-address').text("위치 정보를 가져오는 데 시간이 초과되었습니다.");
                    break;
                case error.UNKNOWN_ERROR:
                    $('#current-address').text("알 수 없는 오류가 발생했습니다.");
                    $('#user-current-address').text("알 수 없는 오류가 발생했습니다.");
                    break;
            }
        }

        // 게임 시작 버튼 클릭 이벤트
        $('#start-game, #user-start-game').click(function () {
            // 임의의 메뉴 추천 로직 (예시)
            const menus = [
                {name: "김치찌개", image: "/images/kimchi_jjigae.jpg"},
                {name: "비빔밥", image: "/images/bibimbap.jpg"},
                {name: "불고기", image: "/images/bulgogi.jpg"},
                {name: "삼겹살", image: "/images/samgyeopsal.jpg"},
                {name: "떡볶이", image: "/images/tteokbokki.jpg"}
            ];

            const randomMenu = menus[Math.floor(Math.random() * menus.length)];

            if ($(this).attr('id') === 'start-game') {
                $('#menu-header').text(randomMenu.name);
                $('#menu-image').attr('src', randomMenu.image).show();
            } else if ($(this).attr('id') === 'user-start-game') {
                $('#user-menu-header').text(randomMenu.name);
                $('#user-menu-image').attr('src', randomMenu.image).show();
                $('#user-rating-controls').show();
            }
        });

        // 별점 선택 이벤트
        $('.star').click(function () {
            const rating = $(this).data('value');
            $('.star').each(function () {
                if ($(this).data('value') <= rating) {
                    $(this).addClass('selected');
                } else {
                    $(this).removeClass('selected');
                }
            });
        });

        // 싫어요 버튼 클릭 이벤트
        $('#user-dislike-button').click(function () {
            alert("싫어요를 선택하셨습니다.");
        });

        // 좋아요 3점 고정 체크박스 이벤트
        $('#fixed-rating-checkbox').change(function () {
            if ($(this).is(':checked')) {
                $('.star').removeClass('selected');
                $('.star').each(function () {
                    if ($(this).data('value') <= 3) {
                        $(this).addClass('selected');
                    }
                });
                $('.star').css('pointer-events', 'none'); // 더 이상 클릭 불가능하게 설정
            } else {
                $('.star').css('pointer-events', 'auto');
            }
        });
    });
</script>
</html>
