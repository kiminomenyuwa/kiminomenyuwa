<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" layout:decorate="~{homeLayout}">
<th:block layout:fragment="links">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css" />
</th:block>

<style layout:fragment="styles">
    .mini-game-content {
        position: relative;
        width: 100%;
        max-width: 1000px;
        height: calc(1000px / 1.618);
        /* í™©ê¸ˆë¹„ìœ¨ ì ìš© */
        margin: 50px auto 0;
        border: 5px solid rgba(255, 120, 120, 1);
        /* ëŒ€í‘œ ì»¬ëŸ¬ë¡œ í…Œë‘ë¦¬ */
        border-radius: 10px;

        /* ì´ë¯¸ì§€ë¥¼ ë°°ê²½ìœ¼ë¡œ ì²˜ë¦¬ (ì •ë¹„ìœ¨ ìœ ì§€) */
        background-size: cover;
        /* ë„ˆë¹„ ê¸°ì¤€ìœ¼ë¡œ ë§ì¶”ê³  ë¹„ìœ¨ì„ ìœ ì§€ */
        background-position: center;
        /* ì¤‘ì•™ ì •ë ¬ */
        background-repeat: no-repeat;
        /* ì´ë¯¸ì§€ ë°˜ë³µ ì•ˆ í•¨ */
    }

    #menu-background {
        background-image: url("/images/menulogo.png");
        /* ê¸°ë³¸ ë°°ê²½ ì´ë¯¸ì§€ */
        background-size: contain;
        /* ì›ë³¸ ë¹„ìœ¨ ìœ ì§€í•˜ë©´ì„œ ë³´ì—¬ì¤Œ */
        background-position: center;
        background-repeat: no-repeat;
    }

    /* ë°°ê²½ ì´ë¯¸ì§€ê°€ ì‘ì€ ê²½ìš°ì—ë„ ë„ˆë¹„ ê¸°ì¤€ìœ¼ë¡œ ì •ë¹„ìœ¨ í™•ëŒ€ */
    .mini-game-content[data-image-url] {
        background-image: url("");
        /* ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë™ì ìœ¼ë¡œ ì´ë¯¸ì§€ ì„¤ì • */
    }

    /* ìƒë‹¨ ì˜¤ë¥¸ìª½ ìœ„ì¹˜ ì •ë³´ */
    .location-container {
        position: absolute;
        top: -40px;
        /* ì‚¬ì§„ ë°”ê¹¥ìª½ */
        right: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
        background-color: transparent;
        color: black;
    }

    span#current-address {
        display: block;
    }

    /* ìƒë‹¨ ì™¼ìª½ [íšŒì›ìš©] */
    .member-label {
        position: absolute;
        top: -40px;
        /* ì‚¬ì§„ ë°”ê¹¥ìª½ */
        left: 10px;
        font-size: 1.2rem;
        font-weight: bold;
        color: black;
        background-color: transparent;
    }

    /* ë©”ë‰´ ì´ë¦„ (ì‚¬ì§„ ì•ˆìª½ ìƒë‹¨ ì˜¤ë¥¸ìª½) */
    .menu-name {
        position: absolute;
        top: 10px;
        /* ì‚¬ì§„ ì•ˆìª½ */
        right: 10px;
        font-size: 1.5rem;
        font-weight: bold;
        color: white;
        /* ì‚¬ì§„ ì•ˆìª½ì´ë¯€ë¡œ í°ìƒ‰ */
        text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
        /* ê°€ë…ì„±ì„ ìœ„í•œ í…ìŠ¤íŠ¸ ê·¸ë¦¼ì */
    }

    /* ë²„íŠ¼ ì»¨í…Œì´ë„ˆ (ì˜¤ë¥¸ìª½ í•˜ë‹¨ ì‚¬ì§„ ì•ˆìª½) */
    .button-container {
        position: absolute;
        bottom: 20px;
        /* ì‚¬ì§„ ì•ˆìª½ */
        right: 20px;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
    }

    /* ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
    .fixed-rating {
        margin-bottom: 10px;
        font-size: 1rem;
        color: white;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        /* ê°€ë…ì„±ì„ ìœ„í•œ ê·¸ë¦¼ì */
    }

    #user-start-game,
    #start-game {
        width: 150px;
        height: 50px;
        margin-bottom: 0px;
        font-size: 16px;
        border: 2px solid rgba(255, 120, 120, 1);
        /* ëŒ€í‘œ ì»¬ëŸ¬ë¡œ í…Œë‘ë¦¬ */
        border-radius: 5px;
        background-color: rgba(255, 120, 120, 1);
        /* ëŒ€í‘œ ì»¬ëŸ¬ë¡œ ë°°ê²½ */
        color: white;
        /* ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ í°ìƒ‰ìœ¼ë¡œ */
        cursor: pointer;
        font-weight: bold;
    }

    /* "ì¢‹ì•„ìš”" ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì„¤ì • */
    #user-like-button {
        display: inline-block;
        /* ìš”ì†Œë¥¼ ì¸ë¼ì¸ ë¸”ë¡ìœ¼ë¡œ ì„¤ì • */
        width: 150px;
        /* ë²„íŠ¼ ë„ˆë¹„ë¥¼ "ì‹«ì–´ìš”" ë²„íŠ¼ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì • */
        height: 50px;
        /* ë²„íŠ¼ ë†’ì´ë¥¼ "ì‹«ì–´ìš”" ë²„íŠ¼ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì • */
        font-size: 16px;
        /* ë²„íŠ¼ í…ìŠ¤íŠ¸ í¬ê¸° */
        border: 2px solid rgba(255, 120, 120, 1);
        /* ëŒ€í‘œ ì»¬ëŸ¬ë¡œ í…Œë‘ë¦¬ */
        border-radius: 5px;
        background-color: rgba(255, 120, 120, 1);
        /* ëŒ€í‘œ ì»¬ëŸ¬ë¡œ ë°°ê²½ */
        color: white;
        /* ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ í°ìƒ‰ìœ¼ë¡œ */
        cursor: pointer;
        /* ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ í¬ì¸í„°ë¡œ ë³€ê²½ */
        position: relative;
        /* ìì‹ ìš”ì†Œì˜ ìœ„ì¹˜ ì„¤ì •ì„ ìœ„í•œ ìƒëŒ€ì  ìœ„ì¹˜ ì§€ì • */
        text-align: center;
        /* í…ìŠ¤íŠ¸ë¥¼ ì¤‘ì•™ ì •ë ¬ */
        line-height: 50px;
        /* í…ìŠ¤íŠ¸ë¥¼ ë²„íŠ¼ ë†’ì´ì— ë§ì¶° ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
        font-weight: bold;
        /* í…ìŠ¤íŠ¸ë¥¼ êµµê²Œ ì„¤ì • */
        overflow: hidden;
        /* ìì‹ ìš”ì†Œê°€ ë²„íŠ¼ì„ ë„˜ì–´ê°€ì§€ ì•Šë„ë¡ ìˆ¨ê¹€ */
    }

    /* "ì‹«ì–´ìš”" ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì„¤ì • (ì¢‹ì•„ìš” ë²„íŠ¼ê³¼ ë™ì¼í•œ í¬ê¸°ë¡œ ì„¤ì •) */
    #user-dislike-button {
        display: inline-block;
        /* ìš”ì†Œë¥¼ ì¸ë¼ì¸ ë¸”ë¡ìœ¼ë¡œ ì„¤ì • */
        width: 150px;
        /* ë²„íŠ¼ ë„ˆë¹„ */
        height: 50px;
        /* ë²„íŠ¼ ë†’ì´ */
        font-size: 16px;
        /* ë²„íŠ¼ í…ìŠ¤íŠ¸ í¬ê¸° */
        border: 2px solid rgba(255, 120, 120, 1);
        /* ëŒ€í‘œ ì»¬ëŸ¬ë¡œ í…Œë‘ë¦¬ */
        border-radius: 5px;
        background-color: rgba(255, 120, 120, 1);
        /* ëŒ€í‘œ ì»¬ëŸ¬ë¡œ ë°°ê²½ */
        color: white;
        /* ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ í°ìƒ‰ìœ¼ë¡œ */
        cursor: pointer;
        /* ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ í¬ì¸í„°ë¡œ ë³€ê²½ */
        text-align: center;
        /* í…ìŠ¤íŠ¸ë¥¼ ì¤‘ì•™ ì •ë ¬ */
        /* line-height: 50px; í…ìŠ¤íŠ¸ë¥¼ ë²„íŠ¼ ë†’ì´ì— ë§ì¶° ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
        font-weight: bold;
        /* í…ìŠ¤íŠ¸ë¥¼ êµµê²Œ ì„¤ì • */
    }

    /* ë³„ì  ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ ì„¤ì • (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ ì²˜ë¦¬) */
    .stars {
        position: absolute;
        /* ë¶€ëª¨ ìš”ì†Œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì ˆëŒ€ ìœ„ì¹˜ ì§€ì • */
        top: 50%;
        /* ë¶€ëª¨ ìš”ì†Œì˜ ì„¸ë¡œ ì¤‘ì•™ì— ìœ„ì¹˜ */
        left: 50%;
        /* ë¶€ëª¨ ìš”ì†Œì˜ ê°€ë¡œ ì¤‘ì•™ì— ìœ„ì¹˜ */
        transform: translate(-50%, -50%);
        /* ì •í™•í•œ ì¤‘ì•™ ìœ„ì¹˜ë¥¼ ìœ„í•´ ë³€í™˜ */
        display: flex;
        /* ë³„ë“¤ì„ í”Œë ‰ìŠ¤ ì»¨í…Œì´ë„ˆë¡œ ì„¤ì • */
        justify-content: center;
        /* ë³„ë“¤ì„ ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
        align-items: center;
        /* ë³„ë“¤ì„ ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
        font-size: 24px;
        /* ë³„ì˜ í¬ê¸° */
        width: auto;
        /* ë³„ ì»¨í…Œì´ë„ˆì˜ ë„ˆë¹„ë¥¼ ë‚´ìš©ì— ë§ê²Œ ìë™ ì„¤ì • */
        height: 24px;
        /* ë³„ ì»¨í…Œì´ë„ˆì˜ ë†’ì´ */
        display: none;
        /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ ì²˜ë¦¬ */
    }

    /* ê¸°ë³¸ ë³„ ìŠ¤íƒ€ì¼ ì„¤ì • */
    .star {
        color: #ccc;
        /* ë³„ì˜ ê¸°ë³¸ ìƒ‰ìƒ (íšŒìƒ‰) */
        cursor: pointer;
        /* ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ í¬ì¸í„°ë¡œ ë³€ê²½ */
        margin: 0;
        /* ë³„ ì‚¬ì´ì˜ ê¸°ë³¸ ê°„ê²© ì œê±° */
        letter-spacing: -3px;
        /* ë³„ë“¤ ì‚¬ì´ì˜ ê°„ê²© ì¡°ì • */
    }

    /* ë…¸ë€ìƒ‰ìœ¼ë¡œ ì±„ì›Œì§€ëŠ” ë³„ ìŠ¤íƒ€ì¼ ì„¤ì • */
    .star.fill {
        color: #ffcc00;
        /* ì±„ì›Œì§„ ë³„ì˜ ìƒ‰ìƒì„ ë…¸ë€ìƒ‰ìœ¼ë¡œ ì„¤ì • */
    }

    /* user-rating-controls ë‚´ ì½˜í…ì¸ ë“¤ì„ ì¤‘ì•™ì— ì •ë ¬ */
    /* ì„¸ë¡œë¡œ ì •ë ¬ë˜ê²Œ í•˜ëŠ” ì½”ë“œ ì¶”ê°€ */
    #user-rating-controls {
        display: flex;
        /* ì»¨íŠ¸ë¡¤ì„ í”Œë ‰ìŠ¤ ë°•ìŠ¤ë¡œ ì„¤ì • */
        flex-direction: column;
        /* ë²„íŠ¼ë“¤ì„ ì„¸ë¡œë¡œ ì •ë ¬ */
        justify-content: left;
        /* ë²„íŠ¼ë“¤ì„ ì™¼ìª½ ì •ë ¬ */
        align-items: center;
        /* ë²„íŠ¼ë“¤ì„ ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
        gap: 10px;
        /* ë²„íŠ¼ë“¤ ì‚¬ì´ì˜ ê°„ê²© ì¡°ì ˆ */
    }

    /* ì¶”ê°€ëœ ìŠ¬ë¦­ ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ */
    .menu-card {
        transition: transform 0.3s;
        margin: 0 10px;
    }

    .menu-card:hover {
        transform: translateY(-5px);
    }

    .menu-photo {
        height: 200px;
        object-fit: cover;
        width: 100%;
    }

    .slick-prev:before,
    .slick-next:before {
        color: #000;
    }

    .ranking-icon {
        position: absolute;
        top: 10px;
        left: 10px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        color: white;
        z-index: 10;
    }

    .ranking-icon.gold {
        background-color: #ffd700;
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
    }

    .ranking-icon.silver {
        background-color: #c0c0c0;
        width: 35px;
        height: 35px;
        font-size: 1.1rem;
    }

    .ranking-icon.bronze {
        background-color: #cd7f32;
        width: 30px;
        height: 30px;
        font-size: 1rem;
    }

    .ranking-icon.normal {
        background-color: rgba(0, 0, 0, 0.5);
        width: 25px;
        height: 25px;
        font-size: 0.9rem;
    }
</style>

<div layout:fragment="content">
    <!-- ë¯¸ë‹ˆê²Œì„ ì»¨í…ì¸  ì „ì²´ë¥¼ ê°ì‹¸ëŠ” div -->
    <div class="mini-game-content" id="menu-background">
        <!-- ë¹„íšŒì›ìš© ë©”ë‰´ ì¶”ì²œ ì„¹ì…˜ -->
        <div sec:authorize="not isAuthenticated()" id="menu-section">
            <div class="member-label">[ë¹„íšŒì›ìš©]</div>
            <!-- ìœ„ì¹˜ì™€ ë°˜ê²½ ì„ íƒ -->
            <div class="location-container" id="location-section">
                <span id="current-address">ìœ„ì¹˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
                <label for="radius-select">/ ë°˜ê²½ ì„ íƒ:</label>
                <select id="radius-select">
                    <option value="300">300m</option>
                    <option value="500" selected>500m</option>
                    <option value="1000">1000m</option>
                    <option value="2000">2000m</option>
                </select>
            </div>

            <!-- ë©”ë‰´ ì¶”ì²œ ë©”ì‹œì§€ ë° ê²°ê³¼ í‘œì‹œ -->
            <div id="selected-menu">

                <h2 class="menu-name" id="guest-menu-header">ë©”ë‰´ ë£°ë ›ì„ ëˆ„ë¥´ì„¸ìš”</h2>
            </div>

            <!-- ê²Œì„ ì‹œì‘ ë²„íŠ¼ -->
            <div class="button-container">
                <div class="button" id="menu-controls">
                    <button id="start-game">ê²Œì„ ì‹œì‘</button>
                </div>
            </div>
        </div>

        <!-- íšŒì›ìš© ë©”ë‰´ ì¶”ì²œ ì„¹ì…˜ -->
        <div sec:authorize="isAuthenticated()" id="user-menu-section">
            <div class="member-label">[íšŒì›ìš©]</div>

            <!-- ìœ„ì¹˜ì™€ ë°˜ê²½ ì„ íƒ -->
            <div class="location-container">
                <span id="user-current-address">ìœ„ì¹˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
                <label for="user-radius-select">/ ë°˜ê²½ ì„ íƒ:</label>
                <select id="user-radius-select">
                    <option value="300">300m</option>
                    <option value="500" selected>500m</option>
                    <option value="1000">1000m</option>
                    <option value="2000">2000m</option>
                </select>
            </div>

            <!-- ë©”ë‰´ ì¶”ì²œ ë©”ì‹œì§€ ë° ê²°ê³¼ í‘œì‹œ -->
            <div id="user-selected-menu">
                <h2 class="menu-name" id="user-menu-header">ë©”ë‰´ ë£°ë ›ì„ ëˆ„ë¥´ì„¸ìš”</h2>
                <!--                <img id="user-menu-image" src="" alt="ë©”ë‰´ ì´ë¯¸ì§€" />-->
            </div>

            <div class="button-container">
                <!-- íšŒì›ìš© ê²Œì„ ì‹œì‘ ë²„íŠ¼ -->
                <div class="button" id="user-menu-controls">
                    <button id="user-start-game">ê²Œì„ ì‹œì‘</button>
                </div>

                <!-- ì¢‹ì•„ìš”/ì‹«ì–´ìš” ë²„íŠ¼ -->
                <div id="user-rating-controls" style="display: none">
                    <!-- 3ì  ê³ ì • ì²´í¬ë°•ìŠ¤ -->
                    <div class="fixed-rating">
                        <input type="checkbox" id="fixed-rating-checkbox" />
                        <label for="fixed-rating-checkbox">ì¢‹ì•„ìš” 3ì  ê³ ì •</label>
                    </div>

                    <!-- ì¢‹ì•„ìš” ë²„íŠ¼ê³¼ ë³„ì  ì»¨íŠ¸ë¡¤ -->
                    <div class="button" id="user-like-button">
                        ì¢‹ì•„ìš”
                        <div class="stars">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                        </div>
                    </div>

                    <!-- ì‹«ì–´ìš” ë²„íŠ¼ -->
                    <button class="button" id="user-dislike-button">ì‹«ì–´ìš”</button>
                </div>
            </div>
            <!-- ë¯¸ë‹ˆê²Œì„ì»¨í…ì¸  -->
        </div>
    </div>
    <!--  ìŠ¬ë¼ì´ë” ìŠ¬ë¦­  -->
    <div id="index-container" class="container mt-5">
        <!-- ë” ë§ì€ ë©”ë‰´ë¥¼ ë³´ê³  ì‹¶ë‹¤ë©´? ë²„íŠ¼ì„ ì ˆëŒ€ ìœ„ì¹˜ë¡œ ì„¤ì • -->
        <h1 id="our-h1" class="mb-4" style="
        margin-bottom: 10px;
    ">ì¶”ì²œ ë©”ë‰´ ëª©ë¡</h1>
        <p id="our-p"> ì·¨í–¥ì— ë§ì¶° ìˆœìœ„ë³„ë¡œ ë©”ë‰´ë¥¼ ì¶”ì²œí•´ë“œë ¤ìš”
            ğŸ¥‡ì˜ê´‘ì˜ ê¸ˆë©”ë‹¬ì€ ì–´ë–¤ ë©”ë‰´ì¸ì§€ í™•ì¸í•´ë³´ì„¸ìš”</p>
        <a th:href="@{/recommendations/map}" class="btn btn-lg d-flex align-items-center top-0 end-0 m-3">
            <i class="fas fa-arrow-right me-2"></i> ë” ë§ì€ ë©”ë‰´ë¥¼ ë³´ê³  ì‹¶ë‹¤ë©´? <span id="our-span" style="
            margin-left: 10px;
            border-bottom: 1px solid;
        ">ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”</span>
        </a>
        <!-- ìŠ¬ë¼ì´ë”ì™€ ë²„íŠ¼ì„ ê°ì‹¸ëŠ” ìƒëŒ€ ìœ„ì¹˜ì˜ ì»¨í…Œì´ë„ˆ -->
        <div class="menu-slider-container position-relative">
            <!-- ìŠ¬ë¦­ ìŠ¬ë¼ì´ë” -->
            <div class="menu-slider">
                <!-- ë©”ë‰´ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>
</div>

<!-- ì „ì²´ì»¨í…ì¸  -->

<th:block layout:fragment="scripts">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

    <script th:inline="javascript">
        $(document).ready(function () {
            // ìœ„ì¹˜ ê´€ë ¨ ë³€ìˆ˜ ì„ ì–¸
            let latitude, longitude;
            let userLatitude, userLongitude;

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            getLocation();

            // ì‚¬ìš©ìì˜ í˜„ì¬ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        function (position) {
                            latitude = position.coords.latitude;
                            longitude = position.coords.longitude;
                            userLatitude = latitude;
                            userLongitude = longitude;
                            getAddressFromCoords(latitude, longitude, "#current-address"); // ë¹„íšŒì›ìš© ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸°
                            getAddressFromCoords(
                                userLatitude,
                                userLongitude,
                                "#user-current-address"
                            ); // íšŒì›ìš© ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸°
                        },
                        function () {
                            alert("ìœ„ì¹˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                        }
                    );
                } else {
                    alert("Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
                }
            }

            // ë„¤ì´ë²„ ì§€ë„ APIë¥¼ ì´ìš©í•˜ì—¬ ì¢Œí‘œë¥¼ ì£¼ì†Œë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
            function getAddressFromCoords(lat, lng, addressElementId) {
                const coords = new naver.maps.LatLng(lat, lng);
                naver.maps.Service.reverseGeocode(
                    {
                        coords: coords,
                    },
                    function (status, response) {
                        if (status !== naver.maps.Service.Status.OK) {
                            return alert("ì£¼ì†Œë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                        }
                        const result = response.v2;
                        const address =
                            result.address.jibunAddress || result.address.roadAddress;
                        $(addressElementId).text(`í˜„ì¬ ìœ„ì¹˜: ${address}`);
                    }
                );
            }

            // ë¹„íšŒì›ìš© "ê²Œì„ ì‹œì‘" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
            $("#start-game").click(function () {
                $.post("/get-random-menu", {}, function (menu) {
                    if (menu) {
                        console.log("Menu received:", menu); // ë©”ë‰´ ì •ë³´ ë¡œê·¸ë¡œ ì¶œë ¥
                        $("#guest-menu-header").text(menu.name); // ì„ íƒëœ ë©”ë‰´ì˜ ì´ë¦„ì„ í™”ë©´ì— í‘œì‹œ
                        // ì´ë¯¸ì§€ URLì´ ì¡´ì¬í•˜ëŠ” ê²½ìš° ë°°ê²½ ì´ë¯¸ì§€ë¡œ ì„¤ì •
                        if (menu.pictureUrl) {
                            $("#menu-background").css(
                                "background-image",
                                `url(${menu.pictureUrl})`
                            );
                        } else {
                            // ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ ë°°ê²½ ì´ë¯¸ì§€ ì œê±°
                            $("#menu-background").css("background-image", "none");
                        }
                        $("#start-game").text("ë‹¤ì‹œ ì‹œì‘");
                        // selected-menuë¥¼ ë³´ì´ë„ë¡ display ìŠ¤íƒ€ì¼ ìˆ˜ì •
                        $("#selected-menu").css("display", "block");
                    } else {
                        alert("ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.");
                    }
                }).fail(function (xhr, status, error) {
                    alert("ë©”ë‰´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    console.log(status, error);
                });
            });

            // íšŒì›ìš© "ê²Œì„ ì‹œì‘" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
            $("#user-start-game").click(function () {
                $("#user-start-game").hide(); // "ê²Œì„ ì‹œì‘" ë²„íŠ¼ ìˆ¨ê¸°ê¸°
                $("#user-rating-controls").show(); // "ì¢‹ì•„ìš”/ì‹«ì–´ìš”" ë²„íŠ¼ í‘œì‹œ
                startGame(); // ê²Œì„ ì‹œì‘ í•¨ìˆ˜ í˜¸ì¶œ
            });

            // "ì‹«ì–´ìš”" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ 0ì ì„ ì£¼ê³  ë©”ë‰´ í‰ê°€
            $("#user-dislike-button").click(function () {
                rateMenu(window.menuId, 0.0); // 0ì ìœ¼ë¡œ ë©”ë‰´ í‰ê°€
            });

            // "ì¢‹ì•„ìš”" ë²„íŠ¼ ê´€ë ¨ ë³€ìˆ˜ ì´ˆê¸°í™”
            const likeButton = document.getElementById("user-like-button"); // "ì¢‹ì•„ìš”" ë²„íŠ¼
            const starsContainer = likeButton.querySelector(".stars"); // ë³„ì  ì»¨í…Œì´ë„ˆ
            const stars = starsContainer.querySelectorAll(".star"); // ê° ë³„ ìš”ì†Œ
            const buttonText = likeButton.firstChild; // "ì¢‹ì•„ìš”" ë²„íŠ¼ì˜ í…ìŠ¤íŠ¸ ë…¸ë“œ
            const fixedRatingCheckbox = document.getElementById(
                "fixed-rating-checkbox"
            ); // 3ì  ê³ ì • ì²´í¬ë°•ìŠ¤

            // "ì¢‹ì•„ìš”" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            likeButton.addEventListener("click", () => {
                if (fixedRatingCheckbox.checked) {
                    // ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒëœ ê²½ìš° 3ì ìœ¼ë¡œ í‰ê°€
                    rateMenu(window.menuId, 3); // 3ì ìœ¼ë¡œ í‰ê°€
                } else {
                    // ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš° ê¸°ì¡´ ë³„ì  ê¸°ëŠ¥ì„ í™œì„±í™”
                    starsContainer.style.display = "flex"; // ë³„ì  ì»¨í…Œì´ë„ˆ í‘œì‹œ
                    buttonText.textContent = ""; // "ì¢‹ì•„ìš”" í…ìŠ¤íŠ¸ ìˆ¨ê¹€
                }
            });

            // "ì¢‹ì•„ìš”" ë²„íŠ¼ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ ë³„ì  ì»¨í…Œì´ë„ˆ í‘œì‹œ ë° í…ìŠ¤íŠ¸ ì§€ì›€
            likeButton.addEventListener("mouseover", () => {
                if (!fixedRatingCheckbox.checked) {
                    starsContainer.style.display = "flex";
                    buttonText.textContent = "";
                }
            });

            // "ì¢‹ì•„ìš”" ë²„íŠ¼ì—ì„œ ë§ˆìš°ìŠ¤ë¥¼ ë—ì„ ë•Œ ë³„ì  ì»¨í…Œì´ë„ˆ ìˆ¨ê¹€ ë° í…ìŠ¤íŠ¸ ë³µì›
            likeButton.addEventListener("mouseout", () => {
                if (!fixedRatingCheckbox.checked) {
                    starsContainer.style.display = "none";
                    buttonText.textContent = "ì¢‹ì•„ìš”";
                    resetStars();
                }
            });

            // ë³„ì ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ ë³„ ì±„ìš°ê¸°
            stars.forEach((star) => {
                star.addEventListener("mouseover", function () {
                    const value = parseInt(star.getAttribute("data-value"));
                    fillStars(value);
                });

                // ë³„ì  í´ë¦­ ì‹œ í‰ê°€
                star.addEventListener("click", function () {
                    const value = parseInt(star.getAttribute("data-value"));

                    rateMenu(window.menuId, value);
                });
            });

            // ë³„ì  ì±„ìš°ëŠ” í•¨ìˆ˜
            function fillStars(value) {
                resetStars();
                stars.forEach((star) => {
                    const starValue = parseInt(star.getAttribute("data-value"));
                    if (starValue <= value) {
                        star.classList.add("fill");
                    }
                });
            }

            // ë³„ì  ì´ˆê¸°í™” í•¨ìˆ˜
            function resetStars() {
                stars.forEach((star) => {
                    star.classList.remove("fill");
                });
            }

            // íšŒì›ìš© ê²Œì„ ì‹œì‘ í•¨ìˆ˜
            function startGame() {
                const radius = $("#user-radius-select").val(); // íšŒì›ìš© ë°˜ê²½ ê°’ ê°€ì ¸ì˜¤ê¸°

                if (!userLatitude || !userLongitude) {
                    alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                    return;
                }

                $.post(
                    "/get-random-menu",
                    {
                        latitude: userLatitude,
                        longitude: userLongitude,
                        radius: radius,
                    },
                    function (menu) {
                        if (menu) {
                            $("#user-menu-header").text(menu.name);
                            window.menuId = menu.menuId;

                            // ì´ë¯¸ì§€ í‘œì‹œ
                            if (menu.pictureUrl) {
                                $("#user-menu-image").attr("src", menu.pictureUrl).show();
                            } else {
                                $("#user-menu-image").hide();
                            }
                        } else {
                            alert("ë°˜ê²½ ë‚´ì— ë” ì´ìƒ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤!");
                            $("#user-rating-controls").hide();
                        }
                    }
                ).fail(function () {
                    alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                });
            }

            // ë©”ë‰´ í‰ê°€ í•¨ìˆ˜
            function rateMenu(menuId, rating) {
                const radius = $("#user-radius-select").val(); // íšŒì›ìš© ë°˜ê²½ ê°’ ê°€ì ¸ì˜¤ê¸°

                $.post(
                    "/rate-menu",
                    { menuId: menuId, rating: rating, radius: radius },
                    function (menu) {
                        if (menu) {
                            $("#user-menu-header").text(menu.name);
                            window.menuId = menu.menuId;

                            // ì´ë¯¸ì§€ í‘œì‹œ
                            if (menu.pictureUrl) {
                                // ë°°ê²½ ì´ë¯¸ì§€ë¡œ ì„¤ì •
                                $("#menu-background").css(
                                    "background-image",
                                    `url(${menu.pictureUrl})`
                                );
                            } else {
                                // ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ ë°°ê²½ ì´ë¯¸ì§€ ì œê±°
                                $("#menu-background").css("background-image", "none");
                            }
                        } else {
                            alert("ë°˜ê²½ ë‚´ì— ë” ì´ìƒ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤!");
                            $("#user-rating-controls").hide();
                        }
                    }
                ).fail(function () {
                    alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                });
            }

            // ì¶”ì²œ ë©”ë‰´ ìŠ¬ë¼ì´ë” ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
            let allRecommendations = {};

            function fetchRecommendations(latitude, longitude) {
                if ($("#user-menu-section").length > 0) {
                    $.ajax({
                        url: "/recommendations/nearby-menus",
                        type: "POST",
                        data: {
                            latitude: latitude,
                            longitude: longitude,
                            radius: 1000,
                            limit: 50,
                        },
                        success: function (response) {
                            console.log("Received response:", response);

                            if (!response || !response.recommendedMenus) {
                                console.error("Invalid response structure:", response);
                                alert("ì˜ëª»ëœ ë°ì´í„°ê°€ ë°˜í™˜ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                                return;
                            }

                            allRecommendations = response.recommendedMenus;
                            displayRecommendations(allRecommendations);
                        },
                        error: function (xhr, status, error) {
                            console.error("Error fetching recommendations:", error);
                            alert(
                                "ì¶”ì²œ ë©”ë‰´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
                            );
                        },
                    });
                }
            }

            function displayRecommendations(menus) {
                const menuSlider = $(".menu-slider");
                menuSlider.empty();

                if (menus.length === 0) {
                    menuSlider.append("<p>ì¶”ì²œ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>");
                    return;
                }

                menus.forEach((menu, index) => {
                    let rankingClass = "normal";
                    if (index === 0) rankingClass = "gold";
                    else if (index === 1) rankingClass = "silver";
                    else if (index === 2) rankingClass = "bronze";

                    const menuCard = `
                        <div>
                            <div class="card menu-card">
                                <div class="ranking-icon ${rankingClass}">${index + 1
                        }</div>
                                <img src="${menu.pictureUrl || "/images/default-menu.png"
                        }" class="card-img-top menu-photo" alt="${menu.name
                        }">
                                <div class="card-body">
                                    <h5 class="card-title">${menu.name}</h5>
                                    <p class="card-text">ê°€ê²©: ${Number(
                            menu.price
                        ).toLocaleString()}ì›</p>
                                    <p class="card-text">${formatCategories(
                            menu.categories
                        )}</p>
                                </div>
                            </div>
                        </div>
                    `;
                    menuSlider.append(menuCard);
                });

                initSlick();
            }

            function initSlick() {
                $(".menu-slider").slick({
                    slidesToShow: 3,
                    slidesToScroll: 1,
                    autoplay: true,
                    autoplaySpeed: 3000,
                    dots: true,
                    arrows: true,
                    responsive: [
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 2,
                            },
                        },
                        {
                            breakpoint: 576,
                            settings: {
                                slidesToShow: 1,
                            },
                        },
                    ],
                });
            }

            function formatCategories(categories) {
                if (!categories || !Array.isArray(categories)) return "";
                return categories
                    .map(
                        (category) =>
                            `<span class="badge bg-secondary badge-category">${category.categoryName}</span>`
                    )
                    .join(" ");
            }

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¶”ì²œ ë©”ë‰´ ê°€ì ¸ì˜¤ê¸°
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;
                        fetchRecommendations(latitude, longitude);
                    },
                    function () {
                        alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    }
                );
            } else {
                alert("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            }
        });
    </script>
</th:block>

</html>